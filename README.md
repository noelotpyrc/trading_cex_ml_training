# Trading CEX ML Training

Machine learning model training pipeline for cryptocurrency trading. Supports LightGBM and HMM models with MLflow integration and rolling validation.

## Structure

```
trading_cex_ml_training/
├── training/              # Core training modules
│   ├── run_lgbm_pipeline.py       # LightGBM training pipeline
│   ├── run_hmm_pipeline.py        # HMM training pipeline
│   ├── prepare_training_data.py   # Data preparation & cleaning
│   ├── lgbm_inference.py          # Model I/O utilities
│   └── hmm_inference.py           # HMM inference utilities
├── mlflow/                # MLflow integration
│   ├── train_and_register.py      # Train + register wrapper
│   └── mlflow_register.py         # Post-training registration
├── rolling/               # Rolling validation
│   ├── generate_rolling_splits.py # Generate time-based splits
│   └── run_rolling_training.py    # Rolling training loop
├── utils/                 # Training utilities
│   ├── calibration.py             # Probability calibration
│   ├── greedy_feature_selector.py # Feature selection
│   └── mlflow_feature_importance.py
└── tests/                 # Unit & integration tests
```

## Setup

```bash
cd /Users/noel/projects/trading_cex_ml_training
python -m venv venv
source venv/bin/activate  # or venv\Scripts\activate on Windows
pip install -r requirements.txt
```

## Usage

### 1. Train a Model (LGBM)

```bash
python training/run_lgbm_pipeline.py --config configs/your_config.json
```

### 2. Train + Register to MLflow

```bash
python mlflow/train_and_register.py \
  --config configs/your_config.json \
  --tracking-uri http://127.0.0.1:5000 \
  --experiment your-experiment \
  --model-name your-model-name \
  --alias Staging
```

### 3. Generate Rolling Splits

```bash
python rolling/generate_rolling_splits.py \
  --config configs/your_config.json \
  --start-date 2023-01-01 \
  --end-date 2024-12-31 \
  --train-months 12 \
  --val-days 7 \
  --test-months 1
```

### 4. Run Rolling Training

```bash
python rolling/run_rolling_training.py \
  --config configs/your_config.json \
  --splits-root /path/to/splits \
  --tracking-uri http://127.0.0.1:5000 \
  --experiment rolling-experiment \
  --model-name rolling-model \
  --register-model
```

## Configuration

Training configs are JSON files that specify:
- Input data paths (pre-built feature CSVs)
- Target variable
- Model hyperparameters
- Train/val/test split strategy
- Feature selection rules

See `configs/` for examples.

## Input Data

This pipeline expects **pre-built feature CSVs** generated by the `trading_cex_data_processing` repository:
- Features CSV: Contains engineered features (multi-timeframe, lags, etc.)
- Targets CSV: Contains target variables (returns, labels, etc.)

## Output

Training produces:
- Trained model file (`model.txt` for LGBM, `model.joblib` for HMM)
- Metrics JSON (`metrics.json`)
- Config snapshot (`pipeline_config.json`)
- Feature importance CSV
- MLflow run tracking (if configured)

## Testing

```bash
python -m pytest tests/
```

## Dependencies

This repo has **no runtime dependency** on feature engineering code. It consumes pre-built CSVs.

For feature generation, use the separate `trading_cex_data_processing` repository.
